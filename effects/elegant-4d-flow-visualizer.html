<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elegant 4D Flow Visualizer</title>
    <style>
        :root {
            color-scheme: dark;
        }
        body {
            margin: 0;
            background: radial-gradient(circle at 50% 20%, #040811 0%, #02040a 55%, #000207 100%);
            overflow: hidden;
            font-family: "Inter", system-ui, sans-serif;
        }
        canvas {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            display: block;
        }
    </style>
</head>
<body>
<canvas id="flow-canvas"></canvas>
<script>
(function() {
    'use strict';

    function rand(min, max) {
        return Math.random() * (max - min) + min;
    }

    function clamp(v, min, max) {
        return v < min ? min : v > max ? max : v;
    }

    var paletteCycles = [
        {
            backdrop: ['#020b1a', '#06163a', '#01050d'],
            current: '#00f7ff',
            plume: '#5c63ff',
            spark: '#ffe066',
            aurora: '#11ffaa'
        },
        {
            backdrop: ['#14021a', '#31063a', '#09010f'],
            current: '#ff00ff',
            plume: '#ff7ae6',
            spark: '#ff914d',
            aurora: '#7fffff'
        },
        {
            backdrop: ['#031409', '#034029', '#000a04'],
            current: '#74ffcf',
            plume: '#4df1ff',
            spark: '#ffe67a',
            aurora: '#3cffc7'
        }
    ];

    function ElegantFlowVisualizer() {
        this.canvas = document.getElementById('flow-canvas');
        this.ctx = this.canvas.getContext('2d');
        this.dpr = window.devicePixelRatio || 1;
        this.time = 0;
        this.streams = [];
        this.ribbons = [];
        this.flareBursts = [];
        this.nullFields = [];
        this.sceneClock = 0;
        this.sceneIndex = 0;
        this.sceneDuration = 18000;
        this.mouseInfluence = { x: 0.5, y: 0.5 };
        this.isRunning = false;
        this.resize();
        this.seedSystems();
        this.bind();
        this.start();
    }

    ElegantFlowVisualizer.prototype.resize = function() {
        var width = window.innerWidth;
        var height = window.innerHeight;
        this.canvas.width = width * this.dpr;
        this.canvas.height = height * this.dpr;
        this.canvas.style.width = width + 'px';
        this.canvas.style.height = height + 'px';
        this.ctx.setTransform(this.dpr, 0, 0, this.dpr, 0, 0);
        this.ctx.lineCap = 'round';
        this.ctx.lineJoin = 'round';
    };

    ElegantFlowVisualizer.prototype.bind = function() {
        var self = this;
        window.addEventListener('resize', function() { self.resize(); });
        document.addEventListener('mousemove', function(e) {
            self.mouseInfluence.x = e.clientX / window.innerWidth;
            self.mouseInfluence.y = e.clientY / window.innerHeight;
        });
    };

    ElegantFlowVisualizer.prototype.seedSystems = function() {
        this.streams.length = 0;
        this.ribbons.length = 0;
        this.flareBursts.length = 0;
        this.nullFields.length = 0;

        var baseCount = 240;
        for (var i = 0; i < baseCount; i++) {
            this.streams.push({
                x: rand(0, this.canvas.width / this.dpr),
                y: rand(0, this.canvas.height / this.dpr),
                z: rand(-1, 1),
                w: rand(-1, 1),
                trail: [],
                trailLength: Math.floor(rand(40, 80)),
                curl: rand(0.002, 0.006),
                hueShift: rand(0, 1),
                velocity: rand(0.3, 1.2)
            });
        }

        for (var j = 0; j < 5; j++) {
            this.nullFields.push({
                x: rand(0.2, 0.8),
                y: rand(0.2, 0.8),
                radius: rand(120, 220),
                intensity: rand(0.6, 1.4),
                drift: rand(0.0004, 0.0012),
                phase: rand(0, Math.PI * 2)
            });
        }

        for (var k = 0; k < 12; k++) {
            this.ribbons.push({
                anchor: rand(0, 1),
                offset: rand(-0.3, 0.3),
                width: rand(1.8, 3.6),
                resonance: rand(0.001, 0.003),
                twist: rand(0.0008, 0.0016),
                vertices: []
            });
        }

        for (var b = 0; b < 45; b++) {
            this.flareBursts.push({
                x: this.canvas.width / this.dpr * 0.5,
                y: this.canvas.height / this.dpr * 0.42,
                radius: rand(40, 280),
                angle: rand(0, Math.PI * 2),
                speed: rand(0.008, 0.02),
                phase: rand(0, Math.PI * 2),
                life: rand(0.2, 1)
            });
        }
    };

    ElegantFlowVisualizer.prototype.nextScene = function() {
        this.sceneIndex = (this.sceneIndex + 1) % paletteCycles.length;
        this.sceneClock = 0;
    };

    ElegantFlowVisualizer.prototype.start = function() {
        if (this.isRunning) return;
        this.isRunning = true;
        this.render(performance.now());
    };

    ElegantFlowVisualizer.prototype.updateStream = function(stream, dt, palette) {
        var time = this.time * 0.0008;
        var influenceX = Math.sin(time * 0.8 + stream.z * 2.0) * 0.4;
        var influenceY = Math.cos(time * 0.6 + stream.w * 2.4) * 0.4;
        var mousePullX = (this.mouseInfluence.x - 0.5) * 2.4;
        var mousePullY = (this.mouseInfluence.y - 0.5) * 2.4;

        var field = 0;
        for (var i = 0; i < this.nullFields.length; i++) {
            var f = this.nullFields[i];
            var fx = (stream.x - this.canvas.width / this.dpr * f.x);
            var fy = (stream.y - this.canvas.height / this.dpr * f.y);
            var dist = Math.sqrt(fx * fx + fy * fy);
            var attenuation = Math.exp(-Math.pow(dist / f.radius, 2));
            field += attenuation * f.intensity * Math.sin(f.phase + time * 6.0);
            f.phase += f.drift * dt;
        }

        var speed = stream.velocity * (1 + field * 0.6);
        stream.x += (Math.sin(stream.w + time * 8 + influenceX) + mousePullX) * speed;
        stream.y += (Math.cos(stream.z + time * 7 + influenceY) + mousePullY) * speed;
        stream.z += Math.sin(time * 1.2 + stream.x * 0.002) * stream.curl;
        stream.w += Math.cos(time * 1.4 + stream.y * 0.002) * stream.curl;

        if (stream.x < -200) stream.x = this.canvas.width / this.dpr + 200;
        if (stream.x > this.canvas.width / this.dpr + 200) stream.x = -200;
        if (stream.y < -200) stream.y = this.canvas.height / this.dpr + 200;
        if (stream.y > this.canvas.height / this.dpr + 200) stream.y = -200;

        stream.trail.unshift({ x: stream.x, y: stream.y, hueShift: stream.hueShift });
        if (stream.trail.length > stream.trailLength) {
            stream.trail.pop();
        }

        this.ctx.beginPath();
        var gradient = this.ctx.createLinearGradient(stream.x, stream.y, stream.trail.length ? stream.trail[stream.trail.length - 1].x : stream.x, stream.trail.length ? stream.trail[stream.trail.length - 1].y : stream.y);
        gradient.addColorStop(0, palette.current);
        gradient.addColorStop(0.4, palette.plume);
        gradient.addColorStop(1, palette.aurora);
        this.ctx.strokeStyle = gradient;
        for (var t = 0; t < stream.trail.length; t++) {
            var point = stream.trail[t];
            var alpha = 1 - t / stream.trail.length;
            this.ctx.globalAlpha = Math.pow(alpha, 1.5);
            if (t === 0) {
                this.ctx.moveTo(stream.x, stream.y);
            }
            this.ctx.lineTo(point.x, point.y);
        }
        this.ctx.lineWidth = clamp(1.6 + field * 0.8, 0.8, 3.2);
        this.ctx.stroke();
        this.ctx.globalAlpha = 1;
    };

    ElegantFlowVisualizer.prototype.updateRibbons = function(dt, palette) {
        var centerX = this.canvas.width / this.dpr * 0.5;
        var centerY = this.canvas.height / this.dpr * 0.45;
        for (var i = 0; i < this.ribbons.length; i++) {
            var ribbon = this.ribbons[i];
            ribbon.vertices.length = 0;
            for (var j = 0; j < 120; j++) {
                var angle = j / 120 * Math.PI * 2 + ribbon.anchor * Math.PI * 2 + this.time * ribbon.resonance;
                var radius = 160 + Math.sin(angle * 3 + this.time * ribbon.twist) * 80;
                var offset = Math.sin(this.time * 0.001 + ribbon.offset * 10) * 40;
                var x = centerX + Math.cos(angle) * radius + offset;
                var y = centerY + Math.sin(angle) * radius + offset * 0.4;
                ribbon.vertices.push({ x: x, y: y });
            }

            this.ctx.beginPath();
            for (var v = 0; v < ribbon.vertices.length; v++) {
                var vert = ribbon.vertices[v];
                if (v === 0) this.ctx.moveTo(vert.x, vert.y);
                else this.ctx.lineTo(vert.x, vert.y);
            }
            this.ctx.closePath();
            var gradient = this.ctx.createLinearGradient(centerX - 200, centerY, centerX + 200, centerY);
            gradient.addColorStop(0, palette.plume);
            gradient.addColorStop(0.5, palette.current);
            gradient.addColorStop(1, palette.aurora);
            this.ctx.strokeStyle = gradient;
            this.ctx.globalAlpha = 0.22;
            this.ctx.lineWidth = ribbon.width;
            this.ctx.stroke();
            this.ctx.globalAlpha = 1;
        }
    };

    ElegantFlowVisualizer.prototype.updateFlares = function(dt, palette) {
        this.ctx.globalCompositeOperation = 'lighter';
        for (var i = 0; i < this.flareBursts.length; i++) {
            var burst = this.flareBursts[i];
            burst.angle += burst.speed * dt;
            burst.life += dt * 0.00008;
            if (burst.life > 1) {
                burst.life = rand(0.05, 0.4);
                burst.radius = rand(80, 320);
                burst.angle = rand(0, Math.PI * 2);
            }
            var cx = this.canvas.width / this.dpr * 0.5;
            var cy = this.canvas.height / this.dpr * 0.48;
            var x = cx + Math.cos(burst.angle) * burst.radius;
            var y = cy + Math.sin(burst.angle) * burst.radius * 0.68;
            var size = 18 + Math.sin(burst.angle * 3 + this.time * 0.002) * 12;
            var radial = this.ctx.createRadialGradient(x, y, 0, x, y, size);
            radial.addColorStop(0, palette.spark);
            radial.addColorStop(0.4, palette.spark + '99');
            radial.addColorStop(1, 'transparent');
            this.ctx.fillStyle = radial;
            this.ctx.fillRect(x - size, y - size, size * 2, size * 2);
        }
        this.ctx.globalCompositeOperation = 'source-over';
    };

    ElegantFlowVisualizer.prototype.drawBackdrop = function(palette) {
        var gradient = this.ctx.createRadialGradient(
            this.canvas.width / this.dpr * 0.5,
            this.canvas.height / this.dpr * 0.35,
            120,
            this.canvas.width / this.dpr * 0.5,
            this.canvas.height / this.dpr * 0.65,
            Math.max(this.canvas.width, this.canvas.height)
        );
        gradient.addColorStop(0, palette.backdrop[0]);
        gradient.addColorStop(0.5, palette.backdrop[1]);
        gradient.addColorStop(1, palette.backdrop[2]);
        this.ctx.fillStyle = gradient;
        this.ctx.fillRect(0, 0, this.canvas.width / this.dpr, this.canvas.height / this.dpr);
    };

    ElegantFlowVisualizer.prototype.render = function(now) {
        if (!this.isRunning) return;
        var dt = now - (this.prevTime || now);
        this.prevTime = now;
        this.time += dt;
        this.sceneClock += dt;
        if (this.sceneClock > this.sceneDuration) {
            this.nextScene();
        }

        var palette = paletteCycles[this.sceneIndex];
        this.drawBackdrop(palette);
        this.updateRibbons(dt, palette);
        for (var i = 0; i < this.streams.length; i++) {
            this.updateStream(this.streams[i], dt, palette);
        }
        this.updateFlares(dt, palette);
        this.renderGlyphField(palette);
        requestAnimationFrame(this.render.bind(this));
    };

    ElegantFlowVisualizer.prototype.renderGlyphField = function(palette) {
        var ctx = this.ctx;
        ctx.save();
        ctx.translate(this.canvas.width / this.dpr * 0.5, this.canvas.height / this.dpr * 0.86);
        var glyphCount = 11;
        for (var i = 0; i < glyphCount; i++) {
            var ratio = i / (glyphCount - 1);
            var scale = 1 + Math.sin(this.time * 0.001 + ratio * Math.PI * 2) * 0.18;
            var width = 120 + ratio * 420;
            var gradient = ctx.createLinearGradient(-width, 0, width, 0);
            gradient.addColorStop(0, palette.backdrop[0] + '00');
            gradient.addColorStop(0.25, palette.current + '33');
            gradient.addColorStop(0.5, palette.aurora + '99');
            gradient.addColorStop(0.75, palette.current + '33');
            gradient.addColorStop(1, palette.backdrop[2] + '00');
            ctx.globalAlpha = 0.12 + ratio * 0.12;
            ctx.lineWidth = 1.2 + ratio * 1.6;
            ctx.strokeStyle = gradient;
            ctx.beginPath();
            var wave = 48 + ratio * 120;
            for (var x = -width; x <= width; x += 12) {
                var y = Math.sin((x / wave) + this.time * 0.002 + ratio * Math.PI) * (22 + ratio * 48) * scale;
                if (x === -width) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }
        ctx.restore();
        ctx.globalAlpha = 1;
    };

    new ElegantFlowVisualizer();
})();
</script>
</body>
</html>
